
*  Create Interactive report 


TABLES : VBAK,VBAP.

TYPES : BEGIN OF R1,

  VBELN TYPE VBAK-VBELN,
  NETWR TYPE VBAK-NETWR,
  GUEBG TYPE VBAK-GUEBG,
  GUEEN TYPE VBAK-GUEEN,
  VKGRP TYPE VBAK-VKGRP,
  POSNR TYPE VBAP-POSNR,
  MATNR TYPE VBAP-MATNR,
  MATKL TYPE VBAP-MATKL,
  PSTYV TYPE VBAP-PSTYV,
  POSAR TYPE VBAP-POSAR,


  END OF R1.



  DATA :IT TYPE STANDARD TABLE OF R1,
        WA TYPE R1,
        IT_FIELDCAT TYPE SLIS_T_FIELDCAT_ALV,
       WA_FIELDCAT TYPE SLIS_FIELDCAT_ALV.

  SELECTION-SCREEN BEGIN OF BLOCK S1.

    SELECT-OPTIONS VBELN FOR VBAK-VBELN.
    SELECT-OPTIONS VBTYP FOR VBAK-VBTYP.
    SELECT-OPTIONS POSNR FOR VBAP-POSNR.

 SELECTION-SCREEN END OF BLOCK S1.



 START-OF-SELECTION.
PERFORM GET_DATA.
PERFORM BUILD_FILDCAT.
PERFORM DISPLAY_DATA.




 FORM GET_DATA.

    SELECT
      VBAK~VBELN,
      VBAK~NETWR,
      VBAK~GUEBG,
      VBAK~GUEEN,
      VBAK~VKGRP,
      VBAP~POSNR,
      VBAP~MATNR,
      VBAP~MATKL,
      VBAP~PSTYV,
      VBAP~POSAR
    FROM VBAK
     INNER JOIN VBAP
     ON Vbak~vbeln = Vbap~VBeln
       WHERE VBAK~VBELN IN @VBELN
     INTO CORRESPONDING FIELDS OF TABLE @IT.

   ENDFORM.




* FIELD CATALOG

   FORM BUILD_FILDCAT.

  WA_FIELDCAT-FIELDNAME = 'VBELN'.
  WA_FIELDCAT-SELTEXT_M = 'Sales Document'.
  WA_FIELDCAT-COL_POS = 1.
  APPEND WA_FIELDCAT TO IT_FIELDCAT.
  CLEAR WA_FIELDCAT.

  WA_FIELDCAT-FIELDNAME = 'NETWR'.
  WA_FIELDCAT-SELTEXT_M = 'Net Value'.
  WA_FIELDCAT-COL_POS = 2.
  APPEND WA_FIELDCAT TO IT_FIELDCAT.
  CLEAR WA_FIELDCAT.

  WA_FIELDCAT-FIELDNAME = 'GUEBG'.
  WA_FIELDCAT-SELTEXT_M = 'Valid From'.
  WA_FIELDCAT-COL_POS = 3.
  APPEND WA_FIELDCAT TO IT_FIELDCAT.
  CLEAR WA_FIELDCAT.

  WA_FIELDCAT-FIELDNAME = 'GUEEN'.
  WA_FIELDCAT-SELTEXT_M = 'Valid to'.
  WA_FIELDCAT-COL_POS = 4.
  APPEND WA_FIELDCAT TO IT_FIELDCAT.
  CLEAR WA_FIELDCAT.

  WA_FIELDCAT-FIELDNAME = 'VKGRP'.
  WA_FIELDCAT-SELTEXT_M = 'Item'.
  WA_FIELDCAT-COL_POS = 5.
  APPEND WA_FIELDCAT TO IT_FIELDCAT.
  CLEAR WA_FIELDCAT.

  WA_FIELDCAT-FIELDNAME = 'POSNR'.
  WA_FIELDCAT-SELTEXT_M = 'Item'.
  WA_FIELDCAT-COL_POS = 6.
  APPEND WA_FIELDCAT TO IT_FIELDCAT.
  CLEAR WA_FIELDCAT.

  WA_FIELDCAT-FIELDNAME = 'MATNR'.
  WA_FIELDCAT-SELTEXT_M = 'Material'.
  WA_FIELDCAT-COL_POS = 7.
  APPEND WA_FIELDCAT TO IT_FIELDCAT.
  CLEAR WA_FIELDCAT.

  WA_FIELDCAT-FIELDNAME = 'MATKL'.
  WA_FIELDCAT-SELTEXT_M = 'Material Group'.
  WA_FIELDCAT-COL_POS = 8.
  APPEND WA_FIELDCAT TO IT_FIELDCAT.
  CLEAR WA_FIELDCAT.

   WA_FIELDCAT-FIELDNAME = 'PSTYV'.
  WA_FIELDCAT-SELTEXT_M = 'Item Category'.
  WA_FIELDCAT-COL_POS = 9.
  APPEND WA_FIELDCAT TO IT_FIELDCAT.
  CLEAR WA_FIELDCAT.

   WA_FIELDCAT-FIELDNAME = 'POSAR'.
  WA_FIELDCAT-SELTEXT_M = 'Item Type'.
  WA_FIELDCAT-COL_POS = 10.
  APPEND WA_FIELDCAT TO IT_FIELDCAT.
  CLEAR WA_FIELDCAT.

ENDFORM.



*interactive code(user command)

FORM CLICK_TCODE USING R_UCOMM LIKE SY-UCOMM
                                RS_SELFIELD TYPE SLIS_SELFIELD.

  DATA: lv_VBELN TYPE VBAK-VBELN.

    CASE rs_selfield-fieldname.

      WHEN 'VBELN'.
         lv_VBELN = |{ rs_selfield-value ALPHA = IN }|.
         SET PARAMETER ID 'AUN' FIELD lv_VBELN.
         CALL TRANSACTION 'VA03' AND SKIP FIRST SCREEN.

    ENDCASE.

ENDFORM.




*  DISPLAY FORM

  FORM DISPLAY_DATA.
  CALL FUNCTION 'REUSE_ALV_GRID_DISPLAY'
   EXPORTING
     i_callback_program                = sy-repid
     IT_FIELDCAT                       = IT_FIELDCAT
     I_CALLBACK_USER_COMMAND           = 'CLICK_TCODE'

    TABLES
      T_OUTTAB                          = IT
   EXCEPTIONS
     PROGRAM_ERROR                     = 1
     OTHERS                            = 2
            .
  IF SY-SUBRC <> 0.
* Implement suitable error handling here
  ENDIF.


ENDFORM.