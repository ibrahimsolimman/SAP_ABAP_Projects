
TABLES : ANEP.

*    Create Stracture 

  TYPES :BEGIN OF R1,

    BUKRS TYPE ANEP-BUKRS,
    ANLN1 TYPE ANEP-ANLN1,
    ANLN2 TYPE ANEP-ANLN2,
    GJAHR TYPE ANEP-GJAHR,
    BZDAT TYPE ANEP-BZDAT,
    BWASL TYPE ANEP-BWASL,
    ANBTR TYPE ANEP-ANBTR,
    NDJAR TYPE ANLB-NDJAR,
    S1 TYPE ANEP-ANBTR,


    END OF R1.


*    Declarations

    DATA : IT TYPE STANDARD TABLE OF R1,
         WA TYPE R1,
         it_fieldcat  TYPE slis_t_fieldcat_alv,
         wa_fieldcat  TYPE slis_fieldcat_alv.


*    DEFINE OF SELECTHION SCREEN

    SELECTION-SCREEN BEGIN OF BLOCK S1.
      SELECT-OPTIONS :BUKRS FOR ANEP-BUKRS NO INTERVALS.
      SELECT-OPTIONS :ANLN1 FOR ANEP-ANLN1.
      SELECT-OPTIONS :ANLN2 FOR ANEP-ANLN2.
      SELECT-OPTIONS :GJAHR FOR ANEP-GJAHR.

      SELECTION-SCREEN END OF BLOCK S1.

  START-OF-SELECTION.
  PERFORM GET_DATA.
  PERFORM BUILD_FIELD_CAT.
  PERFORM DISPLAY_DATA.


*    select statment
  FORM GET_DATA.

    SELECT ANEP~BUKRS,
      ANEP~ANLN1,
      ANEP~ANLN2,
      ANEP~GJAHR,
      ANEP~BZDAT,
      ANEP~BWASL,
      ANEP~ANBTR,
      ANLB~NDJAR
      FROM ANEP
       INNER JOIN ANLB
     ON ANEP~ANLN1 = ANLB~ANLN1
     AND ANEP~ANLN2 = ANLB~ANLN2 AND ANEP~BUKRS = ANLB~BUKRS
     WHERE ANEP~BUKRS IN @BUKRS AND
           ANEP~ANLN1 IN @ANLN1 AND
           ANEP~ANLN2 IN @ANLN2 AND
           ANEP~GJAHR IN @GJAHR


        INTO CORRESPONDING FIELDS OF TABLE @IT.

        LOOP AT IT INTO WA.

          IF WA-NDJAR <> 0.
           WA-S1 = WA-ANBTR / WA-NDJAR.
          ENDIF.
          MODIFY IT FROM WA.
          CLEAR WA.
          ENDLOOP.


     ENDFORM.


*    Display form

     FORM DISPLAY_DATA.

             CALL FUNCTION 'REUSE_ALV_GRID_DISPLAY'
   EXPORTING
     IT_FIELDCAT                       = IT_FIELDCAT
    TABLES
      T_OUTTAB                          = IT
   EXCEPTIONS
     PROGRAM_ERROR                     = 1
     OTHERS                            = 2 .
  IF SY-SUBRC <> 0.
* Implement suitable error handling here
  ENDIF.

         ENDFORM.

         FORM BUILD_FIELD_CAT.
           WA_FIELDCAT-FIELDNAME = 'BUKRS'.
  WA_FIELDCAT-SELTEXT_M = 'Company Code'.
  WA_FIELDCAT-COL_POS = 1.
  APPEND WA_FIELDCAT TO IT_FIELDCAT.
  CLEAR WA_FIELDCAT.


WA_FIELDCAT-FIELDNAME = 'ANLN1'.
  WA_FIELDCAT-SELTEXT_M = 'Asset'.
  WA_FIELDCAT-COL_POS = 2.
  APPEND WA_FIELDCAT TO IT_FIELDCAT.
  CLEAR WA_FIELDCAT.


WA_FIELDCAT-FIELDNAME = 'ANLN2'.
  WA_FIELDCAT-SELTEXT_M = 'Sub-number'.
  WA_FIELDCAT-COL_POS = 3.
  APPEND WA_FIELDCAT TO IT_FIELDCAT.
  CLEAR WA_FIELDCAT.


WA_FIELDCAT-FIELDNAME = 'GJAHR'.
  WA_FIELDCAT-SELTEXT_M = 'Fiscal Year'.
  WA_FIELDCAT-COL_POS = 4.
  APPEND WA_FIELDCAT TO IT_FIELDCAT.
  CLEAR WA_FIELDCAT.


WA_FIELDCAT-FIELDNAME = 'BZDAT'.
  WA_FIELDCAT-SELTEXT_M = 'Date'.
  WA_FIELDCAT-COL_POS = 5.
  APPEND WA_FIELDCAT TO IT_FIELDCAT.
  CLEAR WA_FIELDCAT.


WA_FIELDCAT-FIELDNAME = 'BWASL'.
  WA_FIELDCAT-SELTEXT_M = 'Trans. Type'.
  WA_FIELDCAT-COL_POS = 6.
  APPEND WA_FIELDCAT TO IT_FIELDCAT.
  CLEAR WA_FIELDCAT.


WA_FIELDCAT-FIELDNAME = 'ANBTR'.
  WA_FIELDCAT-SELTEXT_M = 'Amount posted'.
  WA_FIELDCAT-COL_POS = 7.
  APPEND WA_FIELDCAT TO IT_FIELDCAT.
  CLEAR WA_FIELDCAT.


  WA_FIELDCAT-FIELDNAME = 'NDJAR'.
  WA_FIELDCAT-SELTEXT_M = 'Useful life'.
  WA_FIELDCAT-COL_POS = 8.
  APPEND WA_FIELDCAT TO IT_FIELDCAT.
  CLEAR WA_FIELDCAT.


  WA_FIELDCAT-FIELDNAME = 'S1'.
  WA_FIELDCAT-SELTEXT_M = 'Amount'.
  WA_FIELDCAT-COL_POS = 9.
  APPEND WA_FIELDCAT TO IT_FIELDCAT.
  CLEAR WA_FIELDCAT.


           ENDFORM.